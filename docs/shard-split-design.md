# Shard Split è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

åˆ†ç‰‡åˆ†è£‚ï¼ˆShard Splitï¼‰æ˜¯å°†ä¸€ä¸ªå¤§åˆ†ç‰‡æ‹†åˆ†ä¸ºä¸¤ä¸ªå°åˆ†ç‰‡çš„è¿‡ç¨‹ï¼Œç”¨äºï¼š
- å•åˆ†ç‰‡æ•°æ®é‡è¿‡å¤§æ—¶çš„æ°´å¹³æ‰©å±•
- å•åˆ†ç‰‡ QPS è¿‡é«˜æ—¶çš„è´Ÿè½½åˆ†æ•£
- é›†ç¾¤å®¹é‡æ‰©å±•

## è®¾è®¡ç›®æ ‡

1. **æ•°æ®ä¸€è‡´æ€§** - åˆ†è£‚è¿‡ç¨‹ä¸­ä¸ä¸¢å¤±ã€ä¸é‡å¤æ•°æ®
2. **é«˜å¯ç”¨æ€§** - æœ€å°åŒ–æœåŠ¡ä¸­æ–­æ—¶é—´ï¼ˆç›®æ ‡ < 1ç§’ï¼‰
3. **å¯è§‚æµ‹æ€§** - åˆ†è£‚è¿›åº¦å¯æŸ¥è¯¢ã€å¯ç›‘æ§
4. **å¯å›æ»š** - åˆ†è£‚å¤±è´¥å¯å®‰å…¨å›æ»š

## æ•´ä½“æµç¨‹

```
åˆ†è£‚å‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           shard_0001                â”‚
â”‚         slots: [0, 8192)            â”‚
â”‚         æ•°æ®é‡: 10GB                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆ†è£‚å:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   shard_0001    â”‚  â”‚   shard_0002    â”‚
â”‚  slots: [0,4096)â”‚  â”‚ slots:[4096,8192)â”‚
â”‚  æ•°æ®é‡: ~5GB   â”‚  â”‚  æ•°æ®é‡: ~5GB   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## åˆ†è£‚æ–¹æ¡ˆï¼šå¿«ç…§ + å¢é‡æ—¥å¿— + ç¼“å­˜åˆ‡æ¢

### æ–¹æ¡ˆé€‰æ‹©ç†ç”±

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‰æ‹© |
|------|------|------|------|
| åœå†™åˆ†è£‚ | ç®€å• | æœåŠ¡ä¸­æ–­ | âœ— |
| åŒå†™åˆ†è£‚ | é›¶åœæœº | æ•°æ®è¦†ç›–é—®é¢˜ | âœ— |
| å¿«ç…§+å¢é‡Log | é›¶åœæœºã€é¡ºåºæ­£ç¡® | å®ç°å¤æ‚ | âœ“ |

### æ ¸å¿ƒæ€è·¯

1. **å¿«ç…§ä¼ è¾“** - ä¼ è¾“å†å²æ•°æ®
2. **å¢é‡æ—¥å¿—é‡æ”¾** - æŒ‰ Raft Index é¡ºåºè¿½èµ¶
3. **ç¼“å­˜+MOVED** - è¿½å¹³æ—¶ç¼“å­˜è¯·æ±‚ï¼Œåˆ‡æ¢åè¿”å› MOVED

## è¯¦ç»†è®¾è®¡

### é˜¶æ®µ 1: å‡†å¤‡é˜¶æ®µ

```
Pilot                     æº Shard                   ç›®æ ‡ Shard
  â”‚                           â”‚                           â”‚
  â”‚â”€â”€ TriggerSplit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                           â”‚
  â”‚   {                       â”‚                           â”‚
  â”‚     split_key: 4096,      â”‚                           â”‚
  â”‚     target_shard_id,      â”‚                           â”‚
  â”‚     target_nodes          â”‚                           â”‚
  â”‚   }                       â”‚                           â”‚
  â”‚                           â”‚                           â”‚
  â”‚                           â”‚ 1. æ ‡è®°çŠ¶æ€ = Splitting   â”‚
  â”‚                           â”‚ 2. è®°å½• split_key        â”‚
  â”‚                           â”‚                           â”‚
  â”‚â—€â”€â”€ SplitPrepared â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                           â”‚
  â”‚                           â”‚                           â”‚
  â”‚                       åˆ›å»ºç›®æ ‡ Shard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                           â”‚                           â”‚
```

### é˜¶æ®µ 2: å¿«ç…§ä¼ è¾“

```
æº Shard                              ç›®æ ‡ Shard
    â”‚                                      â”‚
    â”‚  1. åˆ›å»ºå¿«ç…§                          â”‚
    â”‚     snapshot_index = N               â”‚
    â”‚                                      â”‚
    â”‚  2. ç­›é€‰ slot âˆˆ [split_key, end)     â”‚
    â”‚     çš„æ•°æ®                           â”‚
    â”‚                                      â”‚
    â”‚â”€â”€â”€â”€â”€â”€ SnapshotChunk â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
    â”‚       {                              â”‚
    â”‚         snapshot_index: N,           â”‚ 3. åŠ è½½å¿«ç…§æ•°æ®
    â”‚         slot_range: [4096, 8192),    â”‚
    â”‚         data: [...],                 â”‚ 4. è®¾ç½® applied_index = N
    â”‚         done: false                  â”‚
    â”‚       }                              â”‚
    â”‚                                      â”‚
    â”‚â”€â”€â”€â”€â”€â”€ SnapshotChunk (done=true) â”€â”€â”€â”€â–¶â”‚
    â”‚                                      â”‚
```

### é˜¶æ®µ 3: å¢é‡è¿½èµ¶

```
æº Shard                              ç›®æ ‡ Shard
    â”‚                                      â”‚
    â”‚  Log: [N+1][N+2][N+3]...             â”‚
    â”‚                                      â”‚
    â”‚  ç­›é€‰ slot âˆˆ [4096, 8192) çš„æ—¥å¿—     â”‚
    â”‚                                      â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€ LogEntry N+1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ apply
    â”‚â”€â”€â”€â”€â”€â”€â”€ LogEntry N+2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ apply
    â”‚â”€â”€â”€â”€â”€â”€â”€ LogEntry N+3 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ apply
    â”‚             ...                      â”‚
    â”‚                                      â”‚
    â”‚  å®šæœŸä¸ŠæŠ¥è¿›åº¦:                        â”‚
    â”‚  delay = source.last_index           â”‚
    â”‚        - target.applied_index        â”‚
    â”‚                                      â”‚
```

**è¿½èµ¶æŒ‡æ ‡ï¼š**
- `delay = æº last_index - ç›®æ ‡ applied_index`
- å½“ `delay < catch_up_threshold (é»˜è®¤100)` æ—¶è¿›å…¥ä¸‹ä¸€é˜¶æ®µ

### é˜¶æ®µ 4: ç¼“å­˜ + åˆ‡æ¢

```
å½“ delay < é˜ˆå€¼æ—¶ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  1. æº Shard å¯¹ [4096, 8192) èŒƒå›´çš„å†™è¯·æ±‚è¿›å…¥ç¼“å­˜æ¨¡å¼        â”‚
â”‚                                                              â”‚
â”‚     Client A â”€â”€â”€ SET foo â”€â”€â”€â–¶ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚     Client B â”€â”€â”€ SET bar â”€â”€â”€â–¶ â”‚ ç¼“å­˜é˜Ÿåˆ— â”‚ (ä¸å¤„ç†ï¼Œåªç¼“å­˜)  â”‚
â”‚     Client C â”€â”€â”€ DEL baz â”€â”€â”€â”€â–¶â”‚ [A,B,C] â”‚                   â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                              â”‚
â”‚  2. ç›®æ ‡ Shard ç»§ç»­è¿½èµ¶æœ€åå‡ æ¡ Log                          â”‚
â”‚                                                              â”‚
â”‚  3. è¿½å¹³å®Œæˆ (applied_index == source.last_index)            â”‚
â”‚                                                              â”‚
â”‚  4. Pilot åŸå­æ›´æ–°è·¯ç”±è¡¨                                     â”‚
â”‚     Version N+1:                                             â”‚
â”‚       shard_0001 -> [0, 4096)                                â”‚
â”‚       shard_0002 -> [4096, 8192)                             â”‚
â”‚                                                              â”‚
â”‚  5. æº Shard å¯¹ç¼“å­˜çš„è¯·æ±‚æ‰¹é‡è¿”å› MOVED                       â”‚
â”‚                                                              â”‚
â”‚     Client A â—€â”€â”€ MOVED 4096 shard_0002 node2:6379           â”‚
â”‚     Client B â—€â”€â”€ MOVED 4096 shard_0002 node2:6379           â”‚
â”‚     Client C â—€â”€â”€ MOVED 4096 shard_0002 node2:6379           â”‚
â”‚                                                              â”‚
â”‚  6. Client é‡å®šå‘åˆ°ç›®æ ‡ Shard æ‰§è¡Œ                           â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é˜¶æ®µ 5: æ¸…ç†

```
1. æº Shard åˆ é™¤ slot âˆˆ [4096, 8192) çš„æ•°æ®ï¼ˆå¯å»¶è¿Ÿæ‰§è¡Œï¼‰
2. æº Shard çŠ¶æ€æ¢å¤ä¸º Normal
3. æ›´æ–° Pilot å…ƒæ•°æ®
4. åˆ†è£‚å®Œæˆ
```

## çŠ¶æ€æœº

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Normal  â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                         â”‚ trigger_split
                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚Preparing â”‚ â”€â”€ åˆ›å»ºç›®æ ‡ Shard
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                         â”‚ target_ready
                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚Snapshot  â”‚ â”€â”€ ä¼ è¾“å¿«ç…§
                    â”‚Transfer  â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                         â”‚ snapshot_done
                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚CatchingUpâ”‚ â”€â”€ å¢é‡æ—¥å¿—è¿½èµ¶
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                         â”‚ delay < threshold
                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚Buffering â”‚ â”€â”€ ç¼“å­˜è¯·æ±‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                         â”‚ caught_up
                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚Switching â”‚ â”€â”€ åˆ‡æ¢è·¯ç”±
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                         â”‚ switched
                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Cleanup  â”‚ â”€â”€ æ¸…ç†æ—§æ•°æ®
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                         â”‚ done
                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Normal  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å…³é”®å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `catch_up_threshold` | 100 æ¡ | å»¶è¿Ÿä½äºæ­¤å€¼è¿›å…¥ç¼“å­˜æ¨¡å¼ |
| `buffer_timeout` | 5 ç§’ | ç¼“å­˜è¯·æ±‚æœ€å¤§ç­‰å¾…æ—¶é—´ |
| `buffer_max_size` | 10000 | æœ€å¤§ç¼“å­˜è¯·æ±‚æ•° |
| `progress_interval` | 1 ç§’ | è¿›åº¦ä¸ŠæŠ¥é—´éš” |
| `snapshot_chunk_size` | 1MB | å¿«ç…§åˆ†å—å¤§å° |

## å¼‚å¸¸å¤„ç†

### åœºæ™¯ 1: è¿½èµ¶å¤ªæ…¢

```
if æŒç»­ 5 åˆ†é’Ÿ delay > 1000:
    option A: é™æµæº Shard å†™å…¥
    option B: å¢åŠ ç›®æ ‡ Shard èµ„æº
    option C: å–æ¶ˆåˆ†è£‚ï¼Œç¨åé‡è¯•
```

### åœºæ™¯ 2: ç¼“å­˜è¶…æ—¶

```
if ç¼“å­˜æ—¶é—´ > buffer_timeout:
    # å›æ»š
    1. æ¢å¤æº Shard æ­£å¸¸å¤„ç†
    2. æ¸…ç©ºç›®æ ‡ Shard
    3. æ ‡è®°åˆ†è£‚å¤±è´¥
    4. å¯¹ç¼“å­˜è¯·æ±‚è¿”å› TRYAGAIN
```

### åœºæ™¯ 3: ç›®æ ‡ Shard å´©æºƒ

```
# å®‰å…¨å›æ»š
1. æº Shard æ•°æ®å®Œæ•´ï¼Œç»§ç»­æœåŠ¡
2. æ¸…ç†åˆ†è£‚çŠ¶æ€
3. ç¨åé‡æ–°è§¦å‘åˆ†è£‚
```

### åœºæ™¯ 4: ç½‘ç»œåˆ†åŒº

```
# è¶…æ—¶æ£€æµ‹
if Pilot ä¸ Shard é€šä¿¡è¶…æ—¶:
    1. ç­‰å¾…ç½‘ç»œæ¢å¤
    2. è¶…è¿‡é˜ˆå€¼åˆ™å›æ»š
```

## API è®¾è®¡

### è§¦å‘åˆ†è£‚

```http
POST /api/v1/shards/{shard_id}/split
{
    "split_slot": 4096,                    // åˆ†è£‚ç‚¹
    "target_shard_id": "shard_0002",       // å¯é€‰ï¼Œè‡ªåŠ¨ç”Ÿæˆ
    "target_nodes": ["node1", "node2"]     // å¯é€‰ï¼Œè‡ªåŠ¨é€‰æ‹©
}

Response:
{
    "split_task_id": "split_xxx",
    "source_shard": "shard_0001",
    "target_shard": "shard_0002",
    "status": "preparing"
}
```

### æŸ¥è¯¢åˆ†è£‚è¿›åº¦

```http
GET /api/v1/splits/{split_task_id}

Response:
{
    "task_id": "split_xxx",
    "status": "catching_up",
    "progress": {
        "snapshot_done": true,
        "source_last_index": 10000,
        "target_applied_index": 9950,
        "delay": 50,
        "eta_seconds": 5
    }
}
```

### å–æ¶ˆåˆ†è£‚

```http
DELETE /api/v1/splits/{split_task_id}
```

## æ•°æ®ç»“æ„

### SplitTask

```rust
pub struct SplitTask {
    pub id: String,
    pub source_shard: ShardId,
    pub target_shard: ShardId,
    pub split_slot: u32,
    pub status: SplitStatus,
    pub progress: SplitProgress,
    pub created_at: DateTime<Utc>,
    pub updated_at: DateTime<Utc>,
}

pub enum SplitStatus {
    Preparing,
    SnapshotTransfer,
    CatchingUp,
    Buffering,
    Switching,
    Cleanup,
    Completed,
    Failed(String),
    Cancelled,
}

pub struct SplitProgress {
    pub snapshot_done: bool,
    pub snapshot_index: u64,
    pub source_last_index: u64,
    pub target_applied_index: u64,
    pub buffered_requests: usize,
}
```

### ShardInfo æ‰©å±•

```rust
pub struct ShardInfo {
    // ... existing fields ...
    
    /// åˆ†è£‚çŠ¶æ€ï¼ˆå¦‚æœæ­£åœ¨åˆ†è£‚ï¼‰
    pub split_state: Option<ShardSplitState>,
}

pub struct ShardSplitState {
    pub split_task_id: String,
    pub split_slot: u32,
    pub role: SplitRole,  // Source or Target
}

pub enum SplitRole {
    Source,
    Target,
}
```

## å®ç°ä¼˜å…ˆçº§

1. **Phase 1** - åŸºç¡€æ¡†æ¶
   - [ ] SplitTask æ•°æ®ç»“æ„
   - [ ] SplitStatus çŠ¶æ€æœº
   - [ ] HTTP API æ¡†æ¶

2. **Phase 2** - å¿«ç…§ä¼ è¾“
   - [ ] ç­›é€‰æ§½ä½èŒƒå›´çš„å¿«ç…§
   - [ ] å¿«ç…§ä¼ è¾“åè®®
   - [ ] ç›®æ ‡ Shard åŠ è½½

3. **Phase 3** - å¢é‡è¿½èµ¶
   - [ ] Log ç­›é€‰å’Œè½¬å‘
   - [ ] è¿›åº¦è¿½è¸ªå’Œä¸ŠæŠ¥
   - [ ] è¿½èµ¶å®Œæˆæ£€æµ‹

4. **Phase 4** - ç¼“å­˜åˆ‡æ¢
   - [ ] è¯·æ±‚ç¼“å­˜é˜Ÿåˆ—
   - [ ] è·¯ç”±åŸå­åˆ‡æ¢
   - [ ] MOVED å“åº”

5. **Phase 5** - å¼‚å¸¸å¤„ç†
   - [ ] è¶…æ—¶å›æ»š
   - [ ] æ•…éšœæ¢å¤
   - [ ] æ¸…ç†é€»è¾‘

## TODO - å¾…å®Œå–„åŠŸèƒ½

### å·²å®Œæˆ âœ…

- [x] SplitTask æ•°æ®ç»“æ„å’ŒçŠ¶æ€æœº
- [x] SplitManager åˆ†è£‚åè°ƒå™¨
- [x] HTTP APIï¼ˆè§¦å‘åˆ†è£‚ã€æŸ¥è¯¢è¿›åº¦ã€å–æ¶ˆåˆ†è£‚ï¼‰
- [x] Node ç«¯è·¯ç”±è¡¨åˆ†è£‚çŠ¶æ€åŒæ­¥
- [x] MOVED/TRYAGAIN å“åº”å¤„ç†

### å¾…å®ç° ğŸš§

#### é«˜ä¼˜å…ˆçº§

- [ ] **Pilot æ¨é€åˆ†è£‚çŠ¶æ€åˆ°è·¯ç”±è¡¨**
  - åœ¨ `RoutingTable` åºåˆ—åŒ–æ—¶åŒ…å« `splitting_shards`
  - Node é€šè¿‡è·¯ç”±è¡¨åŒæ­¥è·å–åˆ†è£‚çŠ¶æ€

- [ ] **å¿«ç…§ä¼ è¾“ï¼ˆç­›é€‰æ§½ä½èŒƒå›´ï¼‰**
  - ä¿®æ”¹ `StateMachine::create_snapshot` æ”¯æŒæ§½ä½èŒƒå›´è¿‡æ»¤
  - å®ç° `split_snapshot(slot_start, slot_end)` æ–¹æ³•
  - ä¼ è¾“å¿«ç…§åˆ°ç›®æ ‡ Shard

- [ ] **å¢é‡æ—¥å¿—è½¬å‘**
  - æº Shard ç­›é€‰ `slot >= split_slot` çš„å†™æ“ä½œ
  - è½¬å‘åˆ°ç›®æ ‡ Shard çš„ Raft ç»„
  - ç›®æ ‡ Shard æŒ‰é¡ºåº apply

- [ ] **è¯·æ±‚ç¼“å†²é˜Ÿåˆ—**
  - å®ç° `SplitBuffer` ç¼“å­˜ buffering é˜¶æ®µçš„è¯·æ±‚
  - è®¾ç½®æœ€å¤§ç¼“å†²æ•°é‡å’Œè¶…æ—¶æ—¶é—´
  - åˆ‡æ¢å®Œæˆåæ‰¹é‡è¿”å› MOVED

#### ä¸­ä¼˜å…ˆçº§

- [ ] **åˆ†è£‚è¿›åº¦ä¸ŠæŠ¥**
  - Node å®šæœŸä¸ŠæŠ¥ `applied_index` åˆ° Pilot
  - Pilot è®¡ç®—å»¶è¿Ÿå¹¶æ›´æ–° `SplitProgress`
  - æ”¯æŒ API æŸ¥è¯¢åˆ†è£‚è¿›åº¦

- [ ] **è‡ªåŠ¨è§¦å‘åˆ†è£‚**
  - ç›‘æ§ Shard æ•°æ®é‡ï¼ˆå­—èŠ‚æ•°ã€key æ•°é‡ï¼‰
  - ç›‘æ§ Shard QPS
  - è¶…è¿‡é˜ˆå€¼è‡ªåŠ¨è§¦å‘åˆ†è£‚

- [ ] **åˆ†è£‚è°ƒåº¦ä¼˜åŒ–**
  - é€‰æ‹©æœ€ä¼˜åˆ†è£‚ç‚¹ï¼ˆæ•°æ®å‡è¡¡ï¼‰
  - é¿å…çƒ­ç‚¹ key é›†ä¸­åœ¨å•ä¸ªåˆ†ç‰‡
  - è€ƒè™‘èŠ‚ç‚¹è´Ÿè½½å‡è¡¡

#### ä½ä¼˜å…ˆçº§

- [ ] **åˆ†è£‚å›æ»šæµ‹è¯•**
  - æ¨¡æ‹Ÿå„é˜¶æ®µå¤±è´¥åœºæ™¯
  - éªŒè¯å›æ»šåæ•°æ®å®Œæ•´æ€§
  - éªŒè¯æœåŠ¡å¯ç”¨æ€§

- [ ] **ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•**
  - å¤šèŠ‚ç‚¹é›†ç¾¤åˆ†è£‚æµ‹è¯•
  - å¹¶å‘è¯»å†™åœºæ™¯æµ‹è¯•
  - å®¢æˆ·ç«¯é‡å®šå‘æµ‹è¯•

- [ ] **ç›‘æ§å’Œå‘Šè­¦**
  - åˆ†è£‚è€—æ—¶ç»Ÿè®¡
  - åˆ†è£‚å¤±è´¥å‘Šè­¦
  - åˆ†è£‚è¿›åº¦å¯è§†åŒ–

- [ ] **åˆ†ç‰‡åˆå¹¶ï¼ˆMergeï¼‰**
  - ä¸åˆ†è£‚ç›¸åçš„æ“ä½œ
  - ç”¨äºç¼©å®¹åœºæ™¯

## å‚è€ƒ

- [Redis Cluster Resharding](https://redis.io/docs/management/scaling/)
- [TiKV Region Split](https://docs.pingcap.com/tidb/stable/tikv-configuration-file#region-split)
- [CockroachDB Range Splits](https://www.cockroachlabs.com/docs/stable/architecture/distribution-layer.html)
